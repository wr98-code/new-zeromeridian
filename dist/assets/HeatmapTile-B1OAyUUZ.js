import{j as s}from"./vendor-radix-C8Wf2Xzy.js";import{r as n}from"./vendor-icons-BDtiwxs7.js";import{G as D}from"./GlassCard-FdfA-xA0.js";import{m as z}from"./vendor-motion-BuE0cxIe.js";import"./index-BrbV88om.js";import"./vendor-utils-CyvyRcDv.js";import"./vendor-query-BhSX34xp.js";import"./vendor-react-DOP_lrST.js";const H=Object.freeze({backend:"canvas2d",isWebGPU:!1,isWebGL2:!1,isDetecting:!0,adapterInfo:null,maxTexture:0});function N(){try{const u=document.createElement("canvas").getContext("webgl2");return u?{supported:!0,maxTexture:u.getParameter(u.MAX_TEXTURE_SIZE)}:{supported:!1,maxTexture:0}}catch{return{supported:!1,maxTexture:0}}}function U(){try{const e=document.createElement("canvas");return!!(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch{return!1}}function J(){const[e,u]=n.useState(H),f=n.useRef(!0),x=n.useRef(!1);n.useEffect(()=>(f.current=!0,()=>{f.current=!1}),[]);const o=n.useCallback(async()=>{if(!f.current)return;if(u(t=>({...t,isDetecting:!0})),"gpu"in navigator)try{const t=await navigator.gpu.requestAdapter();if(t&&f.current){let i=null;try{i=await t.requestAdapterInfo()}catch{}u({backend:"webgpu",isWebGPU:!0,isWebGL2:!1,isDetecting:!1,adapterInfo:i,maxTexture:16384}),x.current=!0;return}}catch{}const{supported:g,maxTexture:c}=N();if(g&&f.current){u({backend:"webgl2",isWebGPU:!1,isWebGL2:!0,isDetecting:!1,adapterInfo:null,maxTexture:c}),x.current=!0;return}if(U()&&f.current){u({backend:"webgl1",isWebGPU:!1,isWebGL2:!1,isDetecting:!1,adapterInfo:null,maxTexture:4096}),x.current=!0;return}f.current&&(u({backend:"canvas2d",isWebGPU:!1,isWebGL2:!1,isDetecting:!1,adapterInfo:null,maxTexture:0}),x.current=!0)},[]);return n.useEffect(()=>{o()},[o]),n.useMemo(()=>({...e,retry:o}),[e,o])}const O=40,q="/api/heatmap?limit="+O;function L(e){return e>10?"rgba(5,150,105,0.95)":e>5?"rgba(16,185,129,0.85)":e>2?"rgba(52,211,153,0.75)":e>.5?"rgba(52,211,153,0.45)":e>-.5?"rgba(30,41,59,0.8)":e>-2?"rgba(251,113,133,0.45)":e>-5?"rgba(251,113,133,0.75)":e>-10?"rgba(244,63,94,0.85)":"rgba(225,29,72,0.95)"}function X(e){return e>2?"rgba(52,211,153,0.5)":e>0?"rgba(52,211,153,0.2)":e>-2?"rgba(251,113,133,0.2)":"rgba(251,113,133,0.5)"}function Y(e,u,f,x,o){if(e.length===0)return[];const g=[];function c(t,i,l,d,a){if(t.length===0)return;if(t.length===1){g.push({...t[0],x:i,y:l,w:d,h:a});return}const y=t.reduce((m,T)=>m+T.marketCap,0);let R=0,h=0;for(let m=0;m<t.length;m++)if(R+=t[m].marketCap,R/y>=.5){h=m+1;break}h=Math.max(1,Math.min(h,t.length-1));const v=t.slice(0,h),M=t.slice(h),p=v.reduce((m,T)=>m+T.marketCap,0)/y;d>=a?(c(v,i,l,d*p,a),c(M,i+d*p,l,d*(1-p),a)):(c(v,i,l,d,a*p),c(M,i,l+a*p,d,a*(1-p)))}return c(e,u,f,x,o),g}function K(e,u,f,x,o,g){e.clearRect(0,0,f,x);for(let c=0;c<u.length;c++){const t=u[c],i=2,l=t.x+i,d=t.y+i,a=t.w-i*2,y=t.h-i*2;if(a<4||y<4)continue;const R=L(t.change),h=X(t.change),v=o===c;if(e.fillStyle=v?R.replace(/[\d.]+\)$/,M=>String(Math.min(1,parseFloat(M)+.2))+")"):R,e.beginPath(),e.roundRect(l,d,a,y,4),e.fill(),e.strokeStyle=v?"rgba(255,255,255,0.4)":h,e.lineWidth=v?1.5/g:1/g,e.stroke(),a>36&&y>24){e.textAlign="center",e.textBaseline="middle";const M=l+a/2,p=d+y/2,m=Math.min(14,Math.max(8,a/6));if(e.fillStyle="rgba(255,255,255,0.92)",e.font="bold "+m+"px JetBrains Mono, monospace",e.fillText(t.symbol.toUpperCase(),M,y>40?p-m*.6:p),y>40){const T=(t.change>=0?"+":"")+t.change.toFixed(2)+"%";e.fillStyle=t.change>=0?"rgba(167,243,208,0.9)":"rgba(254,202,202,0.9)",e.font=m*.8+"px JetBrains Mono, monospace",e.fillText(T,M,p+m*.7)}}}}function V(e){const[u,f]=n.useState([]),[x,o]=n.useState(!0),g=n.useRef(!0),c=n.useCallback(async t=>{try{const i=await fetch(q,{signal:t});if(!i.ok||!g.current)return;const l=await i.json();if(!g.current)return;const d=l.map(a=>({id:String(a.id??""),symbol:String(a.symbol??""),name:String(a.name??""),price:Number(a.current_price??0),change:Number(e==="1h"?a.price_change_percentage_1h_in_currency??0:e==="7d"?a.price_change_percentage_7d_in_currency??0:a.price_change_percentage_24h??0),marketCap:Number(a.market_cap??1),image:String(a.image??"")}));f(d),o(!1)}catch{}},[e]);return n.useEffect(()=>{g.current=!0;const t=new AbortController;o(!0),c(t.signal);const i=setInterval(()=>c(t.signal),6e4);return()=>{g.current=!1,t.abort(),clearInterval(i)}},[c]),{coins:u,loading:x}}const Z=n.memo(()=>{const[e,u]=n.useState("24h"),[f,x]=n.useState(null),[o,g]=n.useState(null),[c,t]=n.useState({x:0,y:0}),i=n.useRef(null),l=n.useRef(null),d=n.useRef(0),a=n.useRef([]),{coins:y,loading:R}=V(e),{backend:h,isWebGL2:v}=J(),M=n.useMemo(()=>{if(y.length===0||!l.current)return[];const r=l.current.clientWidth,S=l.current.clientHeight||220,b=Y(y,0,0,r,S);return a.current=b,b},[y]),p=n.useCallback(()=>{const r=i.current,S=l.current;if(!r||!S)return;const b=window.devicePixelRatio||1,j=S.clientWidth,C=S.clientHeight||220;(r.width!==j*b||r.height!==C*b)&&(r.width=j*b,r.height=C*b,r.style.width=j+"px",r.style.height=C+"px");const k=r.getContext("2d",{willReadFrequently:!1});k&&(v&&(k.imageSmoothingQuality="high"),k.save(),k.scale(b,b),K(k,M,j,C,f,b),k.restore())},[M,f,v]);n.useEffect(()=>{cancelAnimationFrame(d.current),d.current=requestAnimationFrame(p)},[p]),n.useEffect(()=>{const r=new ResizeObserver(()=>{cancelAnimationFrame(d.current),d.current=requestAnimationFrame(p)});return l.current&&r.observe(l.current),()=>r.disconnect()},[p]);const m=n.useCallback(r=>{const S=i.current;if(!S)return;const b=S.getBoundingClientRect(),j=r.clientX-b.left,C=r.clientY-b.top,k=a.current;let I=-1;for(let E=0;E<k.length;E++){const w=k[E];if(j>=w.x&&j<=w.x+w.w&&C>=w.y&&C<=w.y+w.h){I=E,g(w),t({x:r.clientX-b.left,y:r.clientY-b.top});break}}x(I>=0?I:null),I<0&&g(null)},[]),T=n.useCallback(()=>{x(null),g(null)},[]),A=n.useCallback(r=>u(r),[]),_=n.useMemo(()=>({fontFamily:"'JetBrains Mono', monospace",fontSize:9,padding:"2px 8px",borderRadius:3,border:"1px solid rgba(96,165,250,0.12)",background:"transparent",color:"rgba(148,163,184,0.5)",cursor:"pointer"}),[]),G=n.useMemo(()=>({fontFamily:"'JetBrains Mono', monospace",fontSize:9,padding:"2px 8px",borderRadius:3,border:"1px solid rgba(96,165,250,0.35)",background:"rgba(96,165,250,0.1)",color:"rgba(226,232,240,0.9)",cursor:"pointer"}),[]),W=n.useMemo(()=>h==="webgpu"?"⚡ GPU":h==="webgl2"?"▣ GL2":"□ 2D",[h]),F=n.useMemo(()=>h==="webgpu"?"rgba(167,139,250,0.6)":h==="webgl2"?"rgba(96,165,250,0.5)":"rgba(148,163,184,0.3)",[h]),B=Object.freeze([-10,-5,-2,0,2,5,10]),P=Object.freeze(["-10%","-5%","-2%","0%","+2%","+5%","+10%"]);return s.jsxs(D,{style:{height:300,display:"flex",flexDirection:"column",padding:"10px 10px 8px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[s.jsx("span",{style:{fontFamily:"'JetBrains Mono', monospace",fontSize:11,color:"rgba(226,232,240,0.7)",fontWeight:600,letterSpacing:"0.05em"},children:"MARKET HEATMAP"}),s.jsx("span",{style:{fontFamily:"'JetBrains Mono', monospace",fontSize:8,color:F},children:W})]}),s.jsx("div",{style:{display:"flex",gap:3},children:["1h","24h","7d"].map(r=>s.jsx("button",{type:"button",style:e===r?G:_,onClick:()=>A(r),"aria-label":"Timeframe "+r,"aria-pressed":e===r,children:r},r))})]}),s.jsxs("div",{ref:l,style:{flex:1,position:"relative",minHeight:0},children:[R&&s.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"'JetBrains Mono', monospace",fontSize:10,color:"rgba(96,165,250,0.4)"},children:s.jsx(z.span,{animate:{opacity:[.3,1,.3]},transition:{duration:1.5,repeat:1/0},children:"LOADING HEATMAP..."})}),s.jsx("canvas",{ref:i,style:{width:"100%",height:"100%",display:"block",willChange:"transform"},onMouseMove:m,onMouseLeave:T,"aria-label":"Market heatmap treemap",role:"img"}),o&&s.jsxs("div",{style:{position:"absolute",left:Math.min(c.x+8,(l.current?.clientWidth??300)-140),top:Math.max(c.y-60,0),background:"rgba(5,5,14,0.95)",border:"1px solid rgba(96,165,250,0.2)",borderRadius:6,padding:"6px 10px",fontFamily:"'JetBrains Mono', monospace",fontSize:10,pointerEvents:"none",zIndex:10,minWidth:130},children:[s.jsx("div",{style:{color:"rgba(226,232,240,0.9)",fontWeight:700,marginBottom:2},children:o.name}),s.jsx("div",{style:{color:"rgba(148,163,184,0.6)",marginBottom:2},children:"$"+(o.price>=1e3?o.price.toLocaleString("en-US",{maximumFractionDigits:0}):o.price>=1?o.price.toFixed(4):o.price.toFixed(8))}),s.jsx("div",{style:{color:o.change>=0?"rgba(52,211,153,0.9)":"rgba(251,113,133,0.9)"},children:(o.change>=0?"+":"")+o.change.toFixed(2)+"% ("+e+")"})]})]}),s.jsxs("div",{style:{display:"flex",gap:6,marginTop:6,alignItems:"center",fontFamily:"'JetBrains Mono', monospace",fontSize:8,color:"rgba(148,163,184,0.3)"},children:[s.jsx("span",{children:"SIZE = MARKET CAP"}),s.jsx("span",{style:{flex:1}}),P.map((r,S)=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:2},children:[s.jsx("div",{style:{width:8,height:8,borderRadius:2,background:L(B[S])}}),s.jsx("span",{children:r})]},r))]})]})});Z.displayName="HeatmapTile";export{Z as default};
