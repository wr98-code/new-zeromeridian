import{j as r}from"./vendor-radix-C8Wf2Xzy.js";import{r as t}from"./vendor-icons-BDtiwxs7.js";import{G as k}from"./GlassCard-FdfA-xA0.js";import{m as F}from"./vendor-motion-BuE0cxIe.js";import"./index-BrbV88om.js";import"./vendor-utils-CyvyRcDv.js";import"./vendor-query-BhSX34xp.js";import"./vendor-react-DOP_lrST.js";const W=Object.freeze(["BTCUSDT","ETHUSDT","SOLUSDT","BNBUSDT"]),V=Object.freeze(["1m","5m","15m","1h","4h","1d"]),G=200,L=Object.freeze({BTCUSDT:"BTC",ETHUSDT:"ETH",SOLUSDT:"SOL",BNBUSDT:"BNB"}),C=Object.freeze({BTCUSDT:"rgba(251,191,36,1)",ETHUSDT:"rgba(96,165,250,1)",SOLUSDT:"rgba(52,211,153,1)",BNBUSDT:"rgba(251,146,60,1)"}),P="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js",Y=Object.freeze({padding:"16px",display:"flex",flexDirection:"column",gap:"12px"});async function _(d,u,c){try{const n="/api/klines?symbol="+d+"&interval="+u+"&limit="+G,o=await fetch(n,{signal:c});return o.ok?(await o.json()).map(l=>({time:Math.floor(l[0]/1e3),open:Number(l[1]),high:Number(l[2]),low:Number(l[3]),close:Number(l[4]),value:Number(l[5])})):[]}catch{return[]}}let R=!1,j=!1;const D=[];function $(){return new Promise(d=>{const u=window;if(R&&u.LightweightCharts){d(u.LightweightCharts);return}if(D.push(d),j)return;j=!0;const c=document.createElement("script");c.src=P,c.async=!0,c.crossOrigin="anonymous",c.onload=()=>{R=!0,j=!1;const n=u.LightweightCharts;for(const o of D)o(n);D.length=0},document.head.appendChild(c)})}const q=t.memo(({defaultSymbol:d="BTCUSDT",defaultInterval:u="1h",height:c=380})=>{const n=t.useRef(!0),o=t.useRef(null),g=t.useRef(null),l=t.useRef(null),S=t.useRef(null),b=t.useRef(null),[i,v]=t.useState(d),[p,z]=t.useState(u),[B,w]=t.useState(!0),[m,I]=t.useState(null),[h,M]=t.useState(null),x=c-60;t.useEffect(()=>{n.current=!0;let e=null;async function s(){const y=await $();if(!n.current||!o.current)return;const T=o.current.offsetWidth||600,a=x;e=y.createChart(o.current,{width:T,height:a,layout:{background:{color:"rgba(0,0,0,0)"},textColor:"rgba(148,163,184,0.5)",fontFamily:"'Space Mono', monospace",fontSize:10},grid:{vertLines:{color:"rgba(255,255,255,0.04)",style:1},horzLines:{color:"rgba(255,255,255,0.04)",style:1}},crosshair:{vertLine:{color:"rgba(255,255,255,0.15)",width:1,style:0},horzLine:{color:"rgba(255,255,255,0.15)",width:1,style:0}},timeScale:{borderColor:"rgba(255,255,255,0.06)",timeVisible:!0,secondsVisible:!1},rightPriceScale:{borderColor:"rgba(255,255,255,0.06)"},handleScroll:!0,handleScale:!0}),g.current=e,l.current=e.addCandlestickSeries({upColor:"rgba(52,211,153,1)",downColor:"rgba(251,113,133,1)",borderUpColor:"rgba(52,211,153,1)",borderDownColor:"rgba(251,113,133,1)",wickUpColor:"rgba(52,211,153,0.6)",wickDownColor:"rgba(251,113,133,0.6)"}),S.current=e.addHistogramSeries({color:"rgba(96,165,250,0.15)",priceScaleId:"volume",scaleMargins:{top:.85,bottom:0}});const H=new ResizeObserver(()=>{!n.current||!o.current||!g.current||g.current.resize(o.current.offsetWidth,x)});o.current&&H.observe(o.current)}return s(),()=>{n.current=!1,e&&e.remove(),g.current=null,l.current=null,S.current=null}},[]),t.useEffect(()=>{if(!n.current)return;b.current&&b.current.abort(),b.current=new AbortController,w(!0);async function e(){const s=await _(i,p,b.current.signal);if(!n.current)return;if(s.length===0){w(!1);return}if(l.current&&S.current){l.current.setData(s.map(a=>({time:a.time,open:a.open,high:a.high,low:a.low,close:a.close})));const T=C[i];S.current.setData(s.map(a=>({time:a.time,value:a.value,color:a.close>=a.open?T.replace("1)","0.18)"):"rgba(251,113,133,0.12)"}))),g.current?.timeScale().fitContent()}const y=s[s.length-1];n.current&&(I(y.close),M(s.length>=2?s[s.length-2].close:y.open),w(!1))}return e(),()=>{b.current?.abort()}},[i,p]);const O=t.useCallback(e=>{n.current&&v(e)},[]),E=t.useCallback(e=>{n.current&&z(e)},[]),f=t.useMemo(()=>m==null||h==null||h===0?null:(m-h)/h*100,[m,h]),N=t.useMemo(()=>({display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"8px"}),[]),U=t.useMemo(()=>({fontFamily:"'Space Mono', monospace",fontSize:"18px",fontWeight:700,color:C[i],letterSpacing:"0.04em"}),[i]),A=t.useMemo(()=>({fontFamily:"'Space Mono', monospace",fontSize:"11px",marginLeft:"8px",color:f==null?"rgba(148,163,184,0.5)":f>=0?"rgba(52,211,153,1)":"rgba(251,113,133,1)"}),[f]);return r.jsxs(k,{style:Y,children:[r.jsxs("div",{style:N,children:[r.jsx("div",{style:{display:"flex",gap:"4px"},children:W.map(e=>r.jsx("button",{type:"button",onClick:()=>O(e),"aria-pressed":i===e,"aria-label":"Switch to "+L[e],style:{fontFamily:"'Space Mono', monospace",fontSize:"10px",letterSpacing:"0.08em",padding:"4px 10px",borderRadius:"5px",cursor:"pointer",background:i===e?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.025)",border:"1px solid "+(i===e?C[e].replace("1)","0.4)"):"rgba(255,255,255,0.06)"),color:i===e?C[e]:"rgba(148,163,184,0.5)",willChange:"transform"},children:L[e]},e))}),r.jsxs("div",{style:{display:"flex",alignItems:"baseline"},children:[r.jsx("span",{style:U,children:m!=null?"$"+m.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"—"}),f!=null&&r.jsxs("span",{style:A,children:[f>=0?"+":"",f.toFixed(2)+"%"]})]}),r.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:V.map(e=>r.jsx("button",{type:"button",onClick:()=>E(e),"aria-pressed":p===e,"aria-label":"Interval "+e,style:{fontFamily:"'Space Mono', monospace",fontSize:"9px",letterSpacing:"0.06em",padding:"3px 7px",borderRadius:"4px",cursor:"pointer",background:p===e?"rgba(96,165,250,0.14)":"rgba(255,255,255,0.025)",border:"1px solid "+(p===e?"rgba(96,165,250,0.3)":"rgba(255,255,255,0.06)"),color:p===e?"rgba(96,165,250,1)":"rgba(148,163,184,0.4)",willChange:"transform"},children:e},e))})]}),r.jsxs("div",{style:{position:"relative"},children:[B&&r.jsx(F.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"absolute",inset:0,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)",borderRadius:"6px"},children:r.jsx("span",{style:{fontFamily:"'Space Mono', monospace",fontSize:"10px",color:"rgba(148,163,184,0.5)",letterSpacing:"0.1em"},children:"LOADING..."})}),r.jsx("div",{ref:o,style:{width:"100%",height:x+"px",minHeight:x+"px"},role:"img","aria-label":"TradingView chart "+L[i]+" "+p})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("div",{style:{fontFamily:"'Space Mono', monospace",fontSize:"8px",color:"rgba(148,163,184,0.2)",letterSpacing:"0.08em"},children:"TRADINGVIEW LIGHTWEIGHT CHARTS · BINANCE DATA"}),r.jsx("div",{style:{fontFamily:"'Space Mono', monospace",fontSize:"8px",color:"rgba(52,211,153,0.5)",background:"rgba(52,211,153,0.06)",border:"1px solid rgba(52,211,153,0.12)",borderRadius:"3px",padding:"2px 6px",letterSpacing:"0.06em"},children:"PHASE 11"})]})]})});q.displayName="TradingViewChart";export{q as default};
