import{j as r}from"./vendor-radix-C8Wf2Xzy.js";import{r as t}from"./vendor-icons-BDtiwxs7.js";import{G as W}from"./GlassCard-FdfA-xA0.js";import{u as N,m as z}from"./vendor-motion-BuE0cxIe.js";import"./index-BrbV88om.js";import"./vendor-utils-CyvyRcDv.js";import"./vendor-query-BhSX34xp.js";import"./vendor-react-DOP_lrST.js";function L(n,i){let e=0,a=0,c=0,l=0;for(const u of n)e+=u.qty,a+=u.price*u.qty;for(const u of i)c+=u.qty,l+=u.price*u.qty;const p=n[0]?.price??0,o=i[0]?.price??0,m=(p+o)/2,s=o-p,d=e+c;return{midPrice:m,spread:s,spreadPct:m>0?s/m*100:0,imbalance:d>0?(e-c)/d:0,bidVwap:e>0?a/e:p,askVwap:c>0?l/c:o,totalBidQty:e,totalAskQty:c}}async function V(n){if(typeof WebAssembly>"u")return null;try{const i=await fetch("/wasm/orderbook.wasm",{signal:n});if(!i.ok)return null;const e=await i.arrayBuffer();if(!e.byteLength)return null;const{instance:a}=await WebAssembly.instantiate(e,{env:{memory:new WebAssembly.Memory({initial:4})}});return a}catch{return null}}function I(){const n=t.useRef(!0),i=t.useRef(null),[e,a]=t.useState("idle"),[c,l]=t.useState(!1),[p,o]=t.useState(0);t.useEffect(()=>{n.current=!0;const s=new AbortController;async function d(){if(!n.current)return;a("loading");const u=await V(s.signal);n.current&&(u?(i.current=u,l(!0),a("ready")):(l(!1),a("fallback")))}return d().catch(()=>{n.current&&a("fallback")}),()=>{n.current=!1,s.abort()}},[]);const m=t.useCallback((s,d)=>{const u=performance.now();let b;const v=i.current;if(v&&c&&s.length>0&&d.length>0)try{const y=new Float64Array(v.exports.mem.buffer),j=Math.min(s.length,d.length,100),M=0,B=j*2,x=j*4;for(let f=0;f<j;f++)y[M+f*2]=s[f].price,y[M+f*2+1]=s[f].qty,y[B+f*2]=d[f].price,y[B+f*2+1]=d[f].qty;v.exports.compute(M*8,B*8,j,x*8);const[C,R,w,k,h,T,D]=[y[x],y[x+1],y[x+2],y[x+3],y[x+4],y[x+5],y[x+6]];b={midPrice:h,spread:T,spreadPct:h>0?T/h*100:0,imbalance:D,bidVwap:R,askVwap:k,totalBidQty:C,totalAskQty:w}}catch{b=L(s,d)}else b=L(s,d);const A=(performance.now()-u)*1e6;return n.current&&o(Math.round(A)),b},[c]);return t.useMemo(()=>({status:e,isNative:c,compute:m,benchmarkNs:p}),[e,c,m,p])}const Q=Object.freeze([{name:"--zm-trend",syntax:"<number>",inherits:!1,initialValue:"0"},{name:"--zm-intensity",syntax:"<number>",inherits:!1,initialValue:"0.5"},{name:"--zm-hue",syntax:"<number>",inherits:!1,initialValue:"220"}]);function J(){if(!(typeof CSS>"u"||!("registerProperty"in CSS)))for(const n of Q)try{CSS.registerProperty(n)}catch{}}function G(){const n=t.useRef(!0),[i,e]=t.useState("idle"),a=t.useMemo(()=>typeof CSS<"u"&&"paintWorklet"in CSS,[]);t.useEffect(()=>{if(n.current=!0,!a)return e("unsupported"),()=>{n.current=!1};e("loading"),J();const o=CSS;return o.paintWorklet?o.paintWorklet.addModule("/houdini/zmPaint.js").then(()=>{n.current&&e("ready")}).catch(()=>{n.current&&e("unsupported")}):e("unsupported"),()=>{n.current=!1}},[a]);const c=t.useMemo(()=>(o,m=.6,s=220)=>{if(i==="ready")return{"--zm-trend":String(o),"--zm-intensity":String(m),"--zm-hue":String(s),background:"paint(zm-aurora-grid)",willChange:"background"};const d=.05*m;return{background:"radial-gradient(ellipse at 15% 30%, "+(o>=0?"rgba(52,211,153,"+d+")":"rgba(251,113,133,"+d+")")+" 0%, transparent 60%), rgba(5,5,14,0.98)"}},[i]),l=t.useMemo(()=>(o,m=.5)=>{if(i==="ready")return{"--zm-trend":String(o),"--zm-intensity":String(m),background:"paint(zm-price-bg)",willChange:"background"};const s=.06*Math.abs(o)*m;return{background:"linear-gradient(to top, "+(o>=0?"rgba(52,211,153,"+s+")":"rgba(251,113,133,"+s+")")+", transparent 50%), rgba(8,10,18,0.97)"}},[i]),p=t.useMemo(()=>(o=.3)=>i==="ready"?{"--zm-intensity":String(o),background:"paint(zm-noise-tile)",willChange:"background"}:{background:"rgba(8,10,18,1)"},[i]);return t.useMemo(()=>({status:i,isSupported:a,getAuroraBg:c,getPriceBg:l,getNoiseBg:p}),[i,a,c,l,p])}const H=Object.freeze({1:"BTCUSDT",2:"ETHUSDT",3:"BNBUSDT",4:"SOLUSDT",5:"XRPUSDT",6:"ADAUSDT",7:"DOGEUSDT",8:"AVAXUSDT"}),K=Object.freeze({1:"trade",2:"aggTrade",3:"kline",4:"depthUpdate",5:"ticker"});function F(n,i){let e=0,a=0,c=i;for(;c<n.byteLength;){const l=n.getUint8(c++);if(e|=(l&127)<<a,a+=7,!(l&128))break}return[e,c]}function Y(n){try{if(n.byteLength<8)return null;const i=new DataView(n);if(i.getUint8(0)===123)return null;let e=0;const[a,c]=F(i,e);e=c;const[l,p]=F(i,e);if(e=p,e+8>i.byteLength)return null;const o=(i.getUint32(e,!0)+i.getUint32(e+4,!0)*4294967296)/1e8;if(e+=8,e+8>i.byteLength)return null;const m=(i.getUint32(e,!0)+i.getUint32(e+4,!0)*4294967296)/1e8;e+=8;const[s]=F(i,e),d=e+1<i.byteLength?i.getUint8(e+1)===1:!1;return{eventType:K[a]??"unknown",symbol:H[l]??"UNKNOWN",price:o,qty:m,ts:s>1e12?s:Date.now(),isBuyer:d}}catch{return null}}const X=new TextDecoder("utf-8");function _(n){try{const i=typeof n=="string"?n:X.decode(n),e=JSON.parse(i);return e.e==="aggTrade"||e.e==="trade"?{eventType:String(e.e),symbol:String(e.s??"UNKNOWN"),price:parseFloat(String(e.p??0)),qty:parseFloat(String(e.q??0)),ts:typeof e.T=="number"?e.T:Date.now(),isBuyer:e.m===!1,raw:e}:e.e==="24hrTicker"||e.e==="ticker"?{eventType:"ticker",symbol:String(e.s??"UNKNOWN"),price:parseFloat(String(e.c??0)),qty:parseFloat(String(e.v??0)),ts:typeof e.E=="number"?e.E:Date.now(),isBuyer:!1,raw:e}:e.e==="depthUpdate"?{eventType:"depthUpdate",symbol:String(e.s??"UNKNOWN"),price:0,qty:0,ts:typeof e.E=="number"?e.E:Date.now(),isBuyer:!1,raw:e}:null}catch{return null}}function $(){const n=t.useRef(!0),[i,e]=t.useState("idle"),a=t.useRef(0),c=t.useRef(0),l=t.useRef(0),[p,o]=t.useState({decoded:0,binary:0,json:0});t.useEffect(()=>(n.current=!0,e("ready"),()=>{n.current=!1}),[]);const m=t.useCallback(d=>{let u=null;return d instanceof ArrayBuffer&&d.byteLength>0&&new DataView(d).getUint8(0)!==123&&(u=Y(d),u&&c.current++),u||(u=_(d),u&&l.current++),u&&(a.current++,n.current&&a.current%50===0&&o({decoded:a.current,binary:c.current,json:l.current})),u},[]),s=t.useCallback(d=>{const u=m(d);return u?[u]:[]},[m]);return t.useMemo(()=>({status:i,decodedCount:p.decoded,binaryCount:p.binary,jsonCount:p.json,decode:m,decodeMany:s}),[i,p,m,s])}const Z=Object.freeze([20,50,100]),ee=Object.freeze({btcPrice:67840,spread:12});function O(n,i,e,a){const c=[],l=i==="bid"?-1:1,p=Math.floor(a/500);for(let o=0;o<e;o++){const m=(o+1)*5+(p*7+o*13)%5,s=.1+(p*11+o*17)%50/100;c.push({price:n+l*m,qty:parseFloat(s.toFixed(4))})}return c}const U=t.memo(({level:n,maxQty:i,side:e,index:a})=>{const c=i>0?n.qty/i*100:0,l=e==="bid",p=l?"rgba(52,211,153,0.12)":"rgba(251,113,133,0.12)",o=l?"rgba(52,211,153,0.9)":"rgba(251,113,133,0.9)",m=t.useMemo(()=>({position:"relative",display:"flex",justifyContent:"space-between",padding:"2px 12px",fontSize:"11px",fontFamily:"'JetBrains Mono', monospace",willChange:"opacity"}),[]),s=t.useMemo(()=>({position:"absolute",top:0,bottom:0,right:l?0:void 0,left:l?void 0:0,width:c+"%",background:p,pointerEvents:"none",willChange:"width"}),[l,c,p]),d="Price "+n.price.toLocaleString("en-US",{maximumFractionDigits:2})+" qty "+n.qty;return r.jsxs(z.div,{style:m,initial:{opacity:0},animate:{opacity:1},transition:{delay:a*.005,duration:.15},role:"row","aria-label":d,children:[r.jsx("div",{style:s,"aria-hidden":"true"}),r.jsx("span",{style:{color:o,position:"relative"},children:n.price.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}),r.jsx("span",{style:{color:"rgba(148,163,184,0.7)",position:"relative"},children:n.qty.toFixed(4)}),r.jsx("span",{style:{color:"rgba(100,116,139,0.6)",position:"relative",minWidth:"60px",textAlign:"right"},children:(n.price*n.qty).toFixed(0)})]})});U.displayName="LevelRow";const P=t.memo(({imbalance:n})=>{const i=N(),e=Math.abs(n)*50,a=n>=0,c=t.useMemo(()=>({height:"6px",background:"rgba(255,255,255,0.05)",borderRadius:"3px",overflow:"hidden",position:"relative",willChange:"transform"}),[]),l=t.useMemo(()=>({position:"absolute",top:0,bottom:0,left:a?"50%":50-e+"%",width:e+"%",background:a?"rgba(52,211,153,0.7)":"rgba(251,113,133,0.7)",borderRadius:"3px",willChange:"width"}),[a,e]),p=t.useMemo(()=>({position:"absolute",top:0,bottom:0,left:"calc(50% - 0.5px)",width:"1px",background:"rgba(255,255,255,0.15)"}),[]);return r.jsxs("div",{style:c,role:"meter","aria-label":"Order imbalance: "+(n*100).toFixed(1)+"%","aria-valuenow":n,"aria-valuemin":-1,"aria-valuemax":1,children:[r.jsx(z.div,{style:l,animate:i?{}:{width:e+"%"},transition:{duration:.3,ease:"easeOut"}}),r.jsx("div",{style:p,"aria-hidden":"true"})]})});P.displayName="ImbalanceBar";const te=t.memo(({symbol:n="BTCUSDT",basePrice:i=ee.btcPrice})=>{const e=t.useRef(!0),a=t.useRef(null),c=N(),[l,p]=t.useState(20),[o,m]=t.useState({bids:[],asks:[],ts:Date.now()}),s=I(),d=G(),u=$(),b=t.useMemo(()=>o.bids.length===0||o.asks.length===0?{midPrice:i,spread:0,spreadPct:0,imbalance:0,bidVwap:0,askVwap:0,totalBidQty:0,totalAskQty:0}:s.compute(o.bids,o.asks),[o,s,i]),v=t.useMemo(()=>o.bids.reduce((g,S)=>Math.max(g,S.qty),0),[o.bids]),A=t.useMemo(()=>o.asks.reduce((g,S)=>Math.max(g,S.qty),0),[o.asks]),y=t.useCallback(()=>{if(!e.current)return;const g=Date.now();m({bids:O(i,"bid",l,g),asks:O(i,"ask",l,g),ts:g})},[i,l]);t.useEffect(()=>(e.current=!0,y(),a.current=setInterval(y,500),()=>{e.current=!1,a.current&&clearInterval(a.current)}),[y]);const j=t.useCallback(g=>{e.current&&p(g)},[]),M=t.useMemo(()=>d.getPriceBg(b.imbalance,.6),[d,b.imbalance]),B=t.useMemo(()=>({display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"}),[]),x=t.useMemo(()=>({fontFamily:"'Space Mono', monospace",fontSize:"13px",fontWeight:700,color:"rgba(255,255,255,0.9)",letterSpacing:"0.08em",display:"flex",alignItems:"center",gap:"8px"}),[]),C=t.useMemo(()=>({fontSize:"9px",padding:"2px 6px",borderRadius:"4px",fontFamily:"'JetBrains Mono', monospace",letterSpacing:"0.06em",background:s.status==="ready"?"rgba(52,211,153,0.1)":"rgba(96,165,250,0.1)",border:"1px solid "+(s.status==="ready"?"rgba(52,211,153,0.3)":"rgba(96,165,250,0.25)"),color:s.status==="ready"?"rgba(52,211,153,0.9)":"rgba(96,165,250,0.7)"}),[s.status]),R=t.useMemo(()=>({display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px",marginBottom:"12px"}),[]),w=t.useMemo(()=>({background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:"8px",padding:"8px",textAlign:"center"}),[]),k=t.useMemo(()=>({fontFamily:"'JetBrains Mono', monospace",fontSize:"12px",fontWeight:700,color:"rgba(255,255,255,0.9)"}),[]),h=t.useMemo(()=>({fontFamily:"'Space Mono', monospace",fontSize:"9px",color:"rgba(148,163,184,0.5)",marginTop:"2px"}),[]),T=t.useMemo(()=>({display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}),[]),D=t.useMemo(()=>({display:"grid",gridTemplateColumns:"1fr 1fr 1fr",padding:"4px 12px",fontSize:"9px",fontFamily:"'Space Mono', monospace",color:"rgba(100,116,139,0.6)",letterSpacing:"0.06em",borderBottom:"1px solid rgba(255,255,255,0.05)",marginBottom:"4px"}),[]),f=t.useMemo(()=>({textAlign:"center",padding:"8px",fontFamily:"'JetBrains Mono', monospace",fontSize:"14px",fontWeight:700,color:b.imbalance>=0?"rgba(52,211,153,1)":"rgba(251,113,133,1)",borderTop:"1px solid rgba(255,255,255,0.06)",borderBottom:"1px solid rgba(255,255,255,0.06)",willChange:"color"}),[b.imbalance]),q=t.useMemo(()=>({fontSize:"9px",fontFamily:"'JetBrains Mono', monospace",color:"rgba(100,116,139,0.4)",textAlign:"right",marginTop:"8px"}),[]),E=t.useMemo(()=>({display:"flex",gap:"4px"}),[]);return r.jsxs(W,{style:{...M,padding:"16px"},children:[r.jsxs("div",{style:B,children:[r.jsxs("div",{style:x,children:[r.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none","aria-hidden":"true",children:[r.jsx("rect",{x:"1",y:"6",width:"5",height:"7",rx:"1",fill:"rgba(52,211,153,0.7)"}),r.jsx("rect",{x:"8",y:"2",width:"5",height:"11",rx:"1",fill:"rgba(251,113,133,0.7)"})]}),n,r.jsx("span",{style:C,children:s.status==="ready"?"WASM":s.status==="fallback"?"JS":"LOADING"}),d.status==="ready"&&r.jsx("span",{style:{...C,background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.25)",color:"rgba(168,85,247,0.8)"},children:"HOUDINI"}),u.status==="ready"&&r.jsx("span",{style:{...C,background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.2)",color:"rgba(251,191,36,0.7)"},children:"PROTO"})]}),r.jsx("div",{style:E,role:"group","aria-label":"Order book depth",children:Z.map(g=>r.jsx(z.button,{onClick:()=>j(g),style:{padding:"3px 8px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"10px",fontFamily:"'Space Mono', monospace",background:l===g?"rgba(96,165,250,0.15)":"rgba(255,255,255,0.04)",color:l===g?"rgba(96,165,250,0.9)":"rgba(148,163,184,0.5)",willChange:"transform"},whileTap:c?{}:{scale:.95},"aria-label":"Show "+g+" depth levels","aria-pressed":l===g,children:g},g))})]}),r.jsxs("div",{style:R,role:"group","aria-label":"Order book metrics",children:[r.jsxs("div",{style:w,children:[r.jsx("div",{style:k,children:b.midPrice.toLocaleString("en-US",{maximumFractionDigits:2})}),r.jsx("div",{style:h,children:"MID PRICE"})]}),r.jsxs("div",{style:w,children:[r.jsxs("div",{style:{...k,color:"rgba(251,191,36,0.9)"},children:["$",b.spread.toFixed(2)]}),r.jsx("div",{style:h,children:"SPREAD"})]}),r.jsxs("div",{style:w,children:[r.jsxs("div",{style:{...k,color:b.imbalance>=0?"rgba(52,211,153,0.9)":"rgba(251,113,133,0.9)"},children:[(b.imbalance*100).toFixed(1),"%"]}),r.jsx("div",{style:h,children:"IMBALANCE"})]}),r.jsxs("div",{style:w,children:[r.jsx("div",{style:k,children:(b.totalBidQty+b.totalAskQty).toFixed(1)}),r.jsx("div",{style:h,children:"TOTAL QTY"})]})]}),r.jsxs("div",{style:{marginBottom:"12px"},children:[r.jsx(P,{imbalance:b.imbalance}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px",fontSize:"9px",fontFamily:"'Space Mono', monospace",color:"rgba(100,116,139,0.5)"},children:[r.jsx("span",{children:"SELL"}),r.jsx("span",{children:"BUY"})]})]}),r.jsxs("div",{style:T,role:"table","aria-label":"Order book",children:[r.jsxs("div",{children:[r.jsxs("div",{style:D,children:[r.jsx("span",{children:"PRICE"}),r.jsx("span",{style:{textAlign:"right"},children:"QTY"}),r.jsx("span",{style:{textAlign:"right"},children:"TOTAL"})]}),r.jsx("div",{role:"rowgroup",children:o.bids.slice(0,12).map((g,S)=>r.jsx(U,{level:g,maxQty:v,side:"bid",index:S},g.price))})]}),r.jsxs("div",{children:[r.jsxs("div",{style:D,children:[r.jsx("span",{children:"PRICE"}),r.jsx("span",{style:{textAlign:"right"},children:"QTY"}),r.jsx("span",{style:{textAlign:"right"},children:"TOTAL"})]}),r.jsx("div",{role:"rowgroup",children:o.asks.slice(0,12).map((g,S)=>r.jsx(U,{level:g,maxQty:A,side:"ask",index:S},g.price))})]})]}),r.jsxs("div",{style:f,"aria-live":"polite","aria-label":"Mid price: "+b.midPrice.toLocaleString(),children:["≈ ",b.midPrice.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),r.jsxs("span",{style:{fontSize:"10px",opacity:.5,marginLeft:"8px"},children:["VWAP Bid: ",b.bidVwap.toFixed(2)," | Ask: ",b.askVwap.toFixed(2)]})]}),r.jsxs("div",{style:q,"aria-hidden":"true",children:[s.status==="ready"?"WASM engine":"JS engine"," · ","compute: ",s.benchmarkNs>1e3?(s.benchmarkNs/1e3).toFixed(1)+"µs":s.benchmarkNs+"ns"," · ","proto decoded: ",u.decodedCount," · ","houdini: ",d.status]})]})});te.displayName="WasmOrderBook";export{te as default};
