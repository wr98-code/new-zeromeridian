import{r as c}from"./vendor-icons-BDtiwxs7.js";import{i as y}from"./index-BrbV88om.js";const _=Object.freeze(["btcusdt","ethusdt","solusdt","bnbusdt","xrpusdt","adausdt","avaxusdt","dogeusdt","dotusdt","maticusdt","linkusdt","uniusdt","ltcusdt","trxusdt","tonusdt","arbusdt","opusdt","nearusdt","atomusdt","shibusdt"]),D=20;function E(s){return{price:parseFloat(s[0]),size:parseFloat(s[1])}}function v(s,t){if(s.length===0)return[];const d=new Map;for(const e of t)d.set(e.price,e.size);const u=s.slice(0,D);let f=0;const i=u.map(e=>(f+=e.size,{price:e.price,size:e.size,cumSize:f})),o=i.length>0?i[i.length-1].cumSize:1;return i.map(e=>{const p=d.get(e.price);let a="same";return p===void 0?a="new":e.size===0?a="removed":e.size>p?a="up":e.size<p&&(a="down"),{price:e.price,size:e.size,cumSize:e.cumSize,depthPct:o>0?e.cumSize/o*100:0,delta:a}})}function P(s,t){switch(t.type){case"UPDATE":return{...s,bids:t.bids,asks:t.asks,lastUpdateMs:t.ts};case"STATUS":return{...s,wsStatus:t.status};default:return s}}const F={bids:[],asks:[],lastUpdateMs:0,wsStatus:"disconnected"};function I(s="btcusdt"){const[t,d]=c.useReducer(P,F),u=c.useRef(!0),f=c.useRef(null),i=c.useRef(0),o=c.useRef(0),e=c.useRef(null),p=c.useRef([]),a=c.useRef([]),R=c.useCallback(()=>{o.current||(o.current=requestAnimationFrame(()=>{o.current=0;const r=e.current;!r||!u.current||(e.current=null,p.current=r.bids,a.current=r.asks,d({type:"UPDATE",bids:r.bids,asks:r.asks,ts:r.ts}))}))},[]),S=c.useCallback(()=>{if(!u.current)return;d({type:"STATUS",status:"reconnecting"});const r="wss://stream.binance.com:9443/ws/"+s+"@depth20@100ms",n=new WebSocket(r);f.current=n,n.onopen=()=>{if(!u.current){n.close();return}i.current=0,d({type:"STATUS",status:"connected"})},n.onmessage=z=>{if(u.current)try{const U=JSON.parse(z.data),M=U.bids.map(E),x=U.asks.map(E);e.current={bids:M,asks:x,ts:Date.now()},R()}catch{}},n.onclose=()=>{if(u.current&&(d({type:"STATUS",status:"disconnected"}),i.current<10)){const z=y(i.current);i.current+=1,setTimeout(S,z)}},n.onerror=()=>{n.close()}},[s,R]);c.useEffect(()=>(u.current=!0,p.current=[],a.current=[],S(),()=>{u.current=!1,o.current&&(cancelAnimationFrame(o.current),o.current=0),f.current?.close(),e.current=null}),[S]);const w=v(t.bids,p.current),A=v(t.asks,a.current),l=w[0]?.price??0,m=A[0]?.price??0,T=m>0&&l>0?m-l:0,b=l>0&&m>0?(l+m)/2:0,O=b>0?T/b*100:0,k=t.bids.reduce((r,n)=>r+n.size,0),h=t.asks.reduce((r,n)=>r+n.size,0),g=k+h,B=g>0?k/g:.5;return{symbol:s,bids:w,asks:A,spread:T,spreadPct:O,midPrice:b,lastUpdateMs:t.lastUpdateMs,wsStatus:t.wsStatus,totalBidSize:k,totalAskSize:h,bidAskRatio:B}}export{_ as O,I as u};
