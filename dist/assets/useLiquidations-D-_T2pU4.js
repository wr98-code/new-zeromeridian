import{r as a}from"./vendor-icons-BDtiwxs7.js";import{i as A}from"./index-BrbV88om.js";const U="wss://fstream.binance.com/ws/!forceOrder@arr",R=200,v=R+50;let F=0;function E(n){if(n.length===0)return{totalLongLiqUsd:0,totalShortLiqUsd:0,largestEvent:null,eventsPerMinute:0,recentCount:0};const e=Date.now()-6e4;let i=0,l=0,c=0,o=null,f=0;for(const r of n)r.side==="SELL"?i+=r.usdValue:l+=r.usdValue,r.usdValue>c&&(c=r.usdValue,o=r),r.timestamp>=e&&f++;return{totalLongLiqUsd:i,totalShortLiqUsd:l,largestEvent:o,eventsPerMinute:f,recentCount:f}}function D(n,s){switch(s.type){case"ADD":{const e=[...s.events,...n.events],i=e.length>v?e.slice(0,R):e;return{...n,events:i}}case"STATUS":return{...n,wsStatus:s.status};default:return n}}const q={events:[],wsStatus:"disconnected"};function V(){const[n,s]=a.useReducer(D,q),e=a.useRef(!0),i=a.useRef(null),l=a.useRef(0),c=a.useRef(0),o=a.useRef([]),f=a.useCallback(()=>{c.current||(c.current=requestAnimationFrame(()=>{if(c.current=0,!e.current||o.current.length===0)return;const u=o.current;o.current=[],s({type:"ADD",events:u})}))},[]),r=a.useCallback(()=>{if(!e.current)return;s({type:"STATUS",status:"reconnecting"});const u=new WebSocket(U);i.current=u,u.onopen=()=>{if(!e.current){u.close();return}l.current=0,s({type:"STATUS",status:"connected"})},u.onmessage=d=>{if(e.current)try{const p=JSON.parse(d.data),L=Array.isArray(p)?p:[p];for(const S of L){const t=S.o??S;if(!t||!t.s)continue;const g=parseFloat(t.l??"0"),w=parseFloat(t.ap??t.p??"0"),T=parseFloat(t.q??"0"),m=g*w,y={id:t.s+"_"+(t.T??Date.now())+"_"+ ++F,symbol:t.s,side:t.S==="BUY"?"BUY":"SELL",price:parseFloat(t.p??"0"),origQty:T,lastFilledQty:g,lastFilledPrice:w,usdValue:m,timestamp:t.T??Date.now(),isMajor:m>=1e5,isWhale:m>=1e6};o.current.push(y)}o.current.length>0&&f()}catch{}},u.onclose=()=>{if(e.current&&(s({type:"STATUS",status:"disconnected"}),l.current<10)){const d=A(l.current);l.current+=1,setTimeout(r,d)}},u.onerror=()=>{u.close()}},[f]);a.useEffect(()=>(e.current=!0,r(),()=>{e.current=!1,c.current&&(cancelAnimationFrame(c.current),c.current=0),i.current?.close(),o.current=[]}),[r]);const h=E(n.events);return{events:n.events,stats:h,wsStatus:n.wsStatus}}export{V as u};
